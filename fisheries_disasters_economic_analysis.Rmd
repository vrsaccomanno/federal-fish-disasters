---
title: "Fisheries Disasters Economic Estimate"
author: "Vienna Saccomanno"
date: "2/5/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#Attach packages

library(ggplot2)
library(readr)
library(tidyverse)
library(packHV)
library(boot)
library(naniar)

```


```{r}
#Load data
econ_raw <- read_csv("C:/Users/v.r.saccomanno/Desktop/econ_est_R_2.csv")
#View(econ_raw)

```

### 1. Data wrangling and exploration
```{r}
# Exploratory graph
ggplot(econ_raw, aes(x = dollar_diff_real)) +
  geom_histogram(bins = 5) +
  theme_light()
#Non-normal distribution

#Q-Q plots
qqnorm(econ_raw$dollar_diff_real)
#Curving off at the extremities = data have more extreme values that we'd expect if they truly came from a normal distribution

#Test for normality
shapiro.test(econ_raw$dollar_diff_real)
#p-value = 1.153e-10 = statisticlly different from a normal distribution


# Pull revenue change (real) as a vector without imputed values
econ_change <- econ_raw%>% 
  pull(dollar_diff_real)%>%
  na.omit

View(econ_change)
summary(econ_change)
#      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
#-139911239     381701    3975456   37065156   20567427  300618829 
sum(econ_change) #2,816,951,820

```

###2. Use the set.seed function to ensure all results, figures, etc are reproducible.
```{r}
set.seed(123)
```


###3. Create a function for bootstrapping analysis:

```{r}

#### Create a function to calculate the MEAN of varying vectors (x) of index (i)

mean_fun <- function (x,i) {mean(x[i])}

# 100000 bootstrap samples:
set.seed(12345)
boot_mean_100000 <- boot(econ_change, mean_fun, R = 100000)

ggplot() +
  aes(boot_mean_100000$t) +
  geom_histogram()

boot_mean_100000$t0 # to report the mean of the original sample =$37,065,156
boot_mean_100000 # to report bias, SE
#Bias (difference between original sample mean and bootstrapped sampling mean)= $11,138.17
#Std. error (SD of bootstrapped sampling distribution)=$9,616,683


################

#### Create a function to calculate the MEDIAN of varying vectors (x) of index (i)
median_fun <- function (x,i) {median(x[i])}

# 100000 bootstrap samples:
set.seed(12345)
boot_med_100000 <- boot(econ_change, median_fun, R = 100000)

ggplot() +
  aes(boot_med_100000$t) +
  geom_histogram()

boot_med_100000$t0 # Median of the original sample =$3,975,456
boot_med_100000 # to report bias, SE
#Bias (difference between original sample median and bootstrapped sampling median)=$773,239.5 
#Std. error (SD of bootstrapped sampling distribution)= $2,897,660

```


###4. Find a bootstrapped confidence interval:

```{r}
#95% CI for mean statistic
boot.ci(boot_mean_100000, conf = 0.95, type = 'basic') #'basic' = compute differences between each bootstrap replication and t0 and use percentiles of their distribution. 

#Intervals : 
#Level      Basic         
#95%   (17,394,483, 54,900,681)  

# Mean, direct revenue loss in a disaster year is $37,065,156 ($US2019) (n=76), with a boot strapped 95% confidence interval of [$17,394,483, 54,900,681] (n= 100,000 bootstrap samples).

#######################

#95% CI for median statistic, 100,000
boot.ci(boot_med_100000, conf = 0.95, type = 'basic') #'basic' = compute differences between each bootstrap replication and t0 and use percentiles of their distribution. 

#Intervals : 
#Level      Basic         
#95%   (-4,416,735,  6,392,989) 

# Median, direct revenue loss in a disaster year is $3,975,456 ($US2019) (n=76), with a boot strapped 95% confidence interval of [-$4,416,735,  $6,392,989] (n= 100,000 bootstrap samples).
  
```


###5. Other summary statistics

```{r}
#Assess the appropriation amount to revenue loss ratio
appropiation_ratio <- econ_impute %>%
  mutate(app_ratio = appropration_amt/dollar_diff_real)%>%
  drop_na(app_ratio)

count(appropiation_ratio, app_ratio >1)
count(appropiation_ratio, app_ratio <0)
#23 are greater than 1
#31 are less than 1
#16 are negative

mean(appropiation_ratio$app_ratio)
#52.09476
median(appropiation_ratio$app_ratio)
#0.4620938

```
